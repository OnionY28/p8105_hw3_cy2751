p8105_hw3_cy2752
================
Congyu Yang
2024-10-09

## Problem 1

``` r
data("ny_noaa")

(ny_noaa <- 
  ny_noaa %>% 
  separate(date, into = c("year", "month", "day"),sep = "-") %>% 
  mutate(tmax = as.numeric(tmax),
         tmin = as.numeric(tmin),
         year = as.numeric(year),
         month = as.numeric(month),
         day = as.numeric(day)))
```

    ## # A tibble: 2,595,176 × 9
    ##    id           year month   day  prcp  snow  snwd  tmax  tmin
    ##    <chr>       <dbl> <dbl> <dbl> <int> <int> <int> <dbl> <dbl>
    ##  1 US1NYAB0001  2007    11     1    NA    NA    NA    NA    NA
    ##  2 US1NYAB0001  2007    11     2    NA    NA    NA    NA    NA
    ##  3 US1NYAB0001  2007    11     3    NA    NA    NA    NA    NA
    ##  4 US1NYAB0001  2007    11     4    NA    NA    NA    NA    NA
    ##  5 US1NYAB0001  2007    11     5    NA    NA    NA    NA    NA
    ##  6 US1NYAB0001  2007    11     6    NA    NA    NA    NA    NA
    ##  7 US1NYAB0001  2007    11     7    NA    NA    NA    NA    NA
    ##  8 US1NYAB0001  2007    11     8    NA    NA    NA    NA    NA
    ##  9 US1NYAB0001  2007    11     9    NA    NA    NA    NA    NA
    ## 10 US1NYAB0001  2007    11    10    NA    NA    NA    NA    NA
    ## # ℹ 2,595,166 more rows

``` r
ny_noaa %>% 
  count(snow) %>%
  arrange(desc(n))
```

    ## # A tibble: 282 × 2
    ##     snow       n
    ##    <int>   <int>
    ##  1     0 2008508
    ##  2    NA  381221
    ##  3    25   31022
    ##  4    13   23095
    ##  5    51   18274
    ##  6    76   10173
    ##  7     8    9962
    ##  8     5    9748
    ##  9    38    9197
    ## 10     3    8790
    ## # ℹ 272 more rows

This `ny_noaa` dataset contains 2595176 rows and 9 columns. It includes
variables `id` which is the weather station id, `date` of observation,
precipitation in tenths of mm, snowfall in mm, `snwd` representing
snow_depth in mm, and min and max temperature in tenths of degrees C.  

We clean the data by creating separate variables for `year`, `month`,
and `day` and converting them and `tmax` and `tmin` all to numeric
variables.  
We find that 0 is the most commonly observed value for snowfall by using
`arrange()` function. This is because in NY, it is not likely to snow.  
The second most commonly observed value is NA, indicating missing
values. We can see this dataset miss huge amount of data. Other common
values are 25, 31, 51 and 76, suggesting that snowfall is originally
recorded in fractions of an inch and converted to mm.

``` r
ny_noaa %>% 
  filter(month == 1 | month == 7) %>% 
  group_by(id,month,year) %>% 
  summarize(avg_tmax = mean(tmax,na.rm = T)) %>% 
  ggplot(aes(x = year, y = avg_tmax,group = id)) +
  geom_point() + geom_line()+
  facet_grid(. ~ month)+
  labs(title = "Mean monthly temperature for each station across years for January and July")
```

    ## `summarise()` has grouped output by 'id', 'month'. You can override using the
    ## `.groups` argument.

<img src="p8105_hw3_cy2751_files/figure-gfm/unnamed-chunk-2-1.png" width="90%" />
As we can see, the average temperature in January is lower than that in
July for all stations and among all years, which is under expectation.
And all stations follow almost the same trend in the same month. There
are truly some outliers, we can see the January in 1982 and 2005, it is
much colder than usual; July in 1988 is also unexpected cold.

``` r
tmin_tmax_hex <- ny_noaa %>% 
  ggplot(aes(x = tmin, y = tmax))+
  geom_hex()

snow_ridge <- ny_noaa %>% 
  filter(0<snow & snow < 100) %>% 
  group_by(year) %>% 
  ggplot(aes(x = snow,y = as.factor(year)))+
  geom_density_ridges()

tmin_tmax_hex + snow_ridge
```

    ## Picking joint bandwidth of 3.76

<img src="p8105_hw3_cy2751_files/figure-gfm/unnamed-chunk-3-1.png" width="90%" />
Here are the hex and ridge plot:  
For the hex plot, the majority of the data are centered in the middle
for the distribution(which is shown as the lighter color). In the
relatively rare cases, `tmax` is less than `tmin`, which might be caused
by original data error.  
For the ridge plot, the distribution of each year snowfall are all
multi-peak.  
For most of the stations, we see the snow is between 0 and 35 mm in a
year.  
Then there is a another group of stations that see about 45 mm of snow,
and another group that sees nearly 75 mm.  

## Problem 2

``` r
participant_data <- 
  read_csv("hw3_data/nhanes_covar.csv",skip = 4,col_names = T, na = "NA") %>% 
  janitor::clean_names()%>%
  filter(!is.na(bmi) & !is.na(education)) %>% 
  filter(age >= 21) %>% 
  mutate(sex = as.factor(case_match(sex,1 ~ "male", 2 ~ "female")),
         education = as.factor(case_match(education,
                                1 ~ "Less than high school",
                                2 ~ "High school equivalent",
                                3 ~ "More than high school"))) %>% 
  mutate(sex = factor(sex,levels = c("male","female")),
         education = factor(education,levels = c("Less than high school",
                                       "High school equivalent",
                                       "More than high school")))
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
accelerometer_data <- 
  read_csv("hw3_data/nhanes_accel.csv")%>% 
  janitor::clean_names()%>%
  pivot_longer(cols = min1:min1440,
               names_to = "min",
               values_to = "mims",
               names_prefix = "min") %>% 
  mutate(min = as.integer(min))
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
joint_acc_df <- left_join(participant_data,accelerometer_data,by = "seqn")

participant_data %>% 
  janitor::tabyl(education,sex) %>% 
  knitr::kable()
```

| education              | male | female |
|:-----------------------|-----:|-------:|
| Less than high school  |   27 |     28 |
| High school equivalent |   35 |     23 |
| More than high school  |   56 |     59 |

``` r
participant_data %>% 
  ggplot(aes(x = education, y = age,fill = sex))+
  geom_boxplot(alpha = 0.3)
```

<img src="p8105_hw3_cy2751_files/figure-gfm/unnamed-chunk-5-1.png" width="90%" />
\*\*\* Missing Comment \*\*\*

``` r
joint_acc_df %>% group_by(seqn,age,sex,education) %>% 
  summarize(total = sum(mims))%>% 
  ggplot(aes(x = age,y = total,color = sex))+
  geom_point(alpha = 0.3)+
  facet_grid(.~education)+
  geom_smooth(se = F)
```

    ## `summarise()` has grouped output by 'seqn', 'age', 'sex'. You can override
    ## using the `.groups` argument.
    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

<img src="p8105_hw3_cy2751_files/figure-gfm/unnamed-chunk-6-1.png" width="90%" />
\*\*\* Missing Comment \*\*\*

``` r
joint_acc_df %>% group_by(min,education,sex) %>% 
  summarize(mean_mims = mean(mims)) %>% 
  ggplot(aes(x = min,y = mean_mims,color = sex))+
  geom_point(alpha = 0.3)+
  geom_smooth(se = F)+
  facet_grid(education ~ .)
```

    ## `summarise()` has grouped output by 'min', 'education'. You can override using
    ## the `.groups` argument.
    ## `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'

<img src="p8105_hw3_cy2751_files/figure-gfm/unnamed-chunk-7-1.png" width="90%" />

\*\*\* Missing Comment \*\*\*

## Problem 3

``` r
citi_jan_2020 <- read_csv("hw3_data/citibike/Jan 2020 Citi.csv") %>% 
  janitor::clean_names()%>%
  mutate(date = "jan_2020",
    rideable_type = as.factor(rideable_type),
         weekdays = as.factor(weekdays),
         member_casual = as.factor(member_casual)) %>% 
  select(date,everything())
```

    ## Rows: 12420 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (6): ride_id, rideable_type, weekdays, start_station_name, end_station_n...
    ## dbl (1): duration
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
citi_jan_2024 <- read_csv("hw3_data/citibike/Jan 2024 Citi.csv") %>% 
  janitor::clean_names()%>%
  mutate(date = "jan_2024",
    rideable_type = as.factor(rideable_type),
         weekdays = as.factor(weekdays),
         member_casual = as.factor(member_casual))%>% 
  select(date,everything())
```

    ## Rows: 18861 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (6): ride_id, rideable_type, weekdays, start_station_name, end_station_n...
    ## dbl (1): duration
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
citi_jul_2020 <- read_csv("hw3_data/citibike/July 2020 Citi.csv") %>% 
  janitor::clean_names()%>%
  mutate(date = "jul_2020",
    rideable_type = as.factor(rideable_type),
         weekdays = as.factor(weekdays),
         member_casual = as.factor(member_casual)) %>% 
  select(date,everything())
```

    ## Rows: 21048 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (6): ride_id, rideable_type, weekdays, start_station_name, end_station_n...
    ## dbl (1): duration
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
citi_jul_2024 <- read_csv("hw3_data/citibike/July 2024 Citi.csv") %>% 
  janitor::clean_names()%>%
  mutate(date = "jul_2024",
    rideable_type = as.factor(rideable_type),
         weekdays = as.factor(weekdays),
         member_casual = as.factor(member_casual))%>% 
  select(date,everything())
```

    ## Rows: 47156 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (6): ride_id, rideable_type, weekdays, start_station_name, end_station_n...
    ## dbl (1): duration
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
citi_all <- bind_rows(citi_jan_2020,citi_jan_2024,citi_jul_2020,
                      citi_jul_2024)
```

\*\*\* describe the resulting dataset \*\*\*

``` r
citi_all %>% group_by(date,member_casual) %>% 
  summarize(frcy = n()) %>% 
  pivot_wider(names_from = "member_casual",
              values_from = "frcy") %>% 
  knitr::kable()
```

    ## `summarise()` has grouped output by 'date'. You can override using the
    ## `.groups` argument.

| date     | casual | member |
|:---------|-------:|-------:|
| jan_2020 |    984 |  11436 |
| jan_2024 |   2108 |  16753 |
| jul_2020 |   5637 |  15411 |
| jul_2024 |  10894 |  36262 |

``` r
citi_jul_2024 %>% 
  group_by(start_station_name) %>% 
  summarise(frcy = n()) %>% 
  arrange(desc(frcy)) %>% 
  head(5) %>% 
  knitr::kable()
```

| start_station_name       | frcy |
|:-------------------------|-----:|
| Pier 61 at Chelsea Piers |  163 |
| University Pl & E 14 St  |  155 |
| W 21 St & 6 Ave          |  152 |
| West St & Chambers St    |  150 |
| W 31 St & 7 Ave          |  146 |

``` r
citi_all %>% separate(date,into = c("month","year"),sep = "_")%>% 
  mutate(weekdays = factor(weekdays,
                           levels = c("Monday","Tuesday","Wednesday",
                              "Thursday","Friday","Saturday","Sunday"))) %>% 
  group_by(year,month,weekdays) %>% 
  summarise(median_duration = median(duration)) %>% 
  ggplot(aes(x = weekdays, y = median_duration,color = year,group = year))+
  geom_point()+ geom_line()+
  facet_grid(.~month,labeller = as_labeller(c("jan" = "January","jul" = "July")))+
  theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1),
        legend.position = "bottom")
```

    ## `summarise()` has grouped output by 'year', 'month'. You can override using the
    ## `.groups` argument.

<img src="p8105_hw3_cy2751_files/figure-gfm/unnamed-chunk-11-1.png" width="90%" />
\*\*\* Comment \*\*\*

``` r
citi_all %>% filter(date == "jan_2024" | date == "jul_2024") %>% 
  group_by(date,rideable_type,member_casual) %>% 
  ggplot(aes(x = date,y = duration,fill = rideable_type))+
  geom_boxplot()+
  facet_grid(. ~ member_casual)
```

<img src="p8105_hw3_cy2751_files/figure-gfm/unnamed-chunk-12-1.png" width="90%" />

\*\*\* Comment \*\*\*
